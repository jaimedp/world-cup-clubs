/*! Contour-Data-Connectors - v0.9.5 - 2014-05-23 */

!function(){"use strict";function a(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a.prototype.constructor=a}Contour.extend=function(a){for(var b,c=Array.prototype.slice.call(arguments,1),d=0;d<c.length;d++)if(b=c[d])for(var e in b)a[e]=b[e];return a},Contour.extendClass=function(b,c){var d,e=this;return d=b&&b.hasOwnProperty("constructor")?b.constructor:function(){return e.apply(this,arguments)},Contour.extend(d,e,c),a(d,e),b&&Contour.extend(d.prototype,b),d}}(),function(){"use strict";Contour=Contour||{},Contour.connectors=Contour.connectors||{},Contour.Base=function(){},Contour.Base.extend=Contour.extendClass}(),function(){"use strict";Contour.connectors.ConnectorBase=Contour.Base.extend({initialize:function(){},fetch:function(a,b){var c=this;return d3.text(a,function(a){c.parse(a),b&&b.call(c,a)})},getDimensions:function(){if(!this._data.length)return this._headers[0];var a=[],b=this._data[1];return _.each(this._headers,function(c,d){_.isNaN(+b[d].trim())&&a.push(c)},this),a},getMeasures:function(){var a=[],b=this._data[1];return _.each(this._headers,function(c,d){_.isNaN(+b[d].trim())||a.push(c)},this),a},dimension:function(a){return arguments.length?(this._dimension=this._headers.indexOf(a.toLowerCase().trim()),this):this._headers[this._dimension]},filter:function(a){return this._filterSelector="function"==typeof a?selector:function(b){for(var c in a){var d=this._headers.indexOf(c);if(d>=0&&b[d]!==a[c])return!1}return!0},this},newMeasure:function(a,b){return this._newMeasure={name:a,fn:b,index:this._headers.length},this},_rollup:function(a,b){var c,d={},e=b,f=!1;if(_.each(a,function(a){(c=d[a[e]])||(d[a[e]]=c=[]),c.push(a),f=c.length>1}),!f)return a;var g=[],h=[],i=function(a){_.each(a,function(a,b){if(b===e||_.isNaN(+a))h[b]=h[b]||a;else{var c=+a;h[b]=(h[b]||0)+c}})};for(var j in d)h=[],_.each(d[j],i),g.push(h);return g},measure:function(a,b){a=_.isArray(a)?a:[a];var c=function(a){return a.toLowerCase().trim()};return this.data(_.map(a,c),_.map(b,c))},top:function(a){return this._take=a,this},bottom:function(a){return this._take=-a,this},data:function(a,b){a=_.isArray(a)?a:[a];var c=this,d=this._filterSelector?_.filter(c._data,function(a,b){return c._filterSelector.call(c,a,b,c._headers)}):this._data,e=this._newMeasure?_.map(d,function(a,b){var d=a.slice();return d.push(c._newMeasure.fn.call(c,a,b,c._headers)),d}):d,f=this._rollup(e,this._dimension),g=this._getMeasureIndex(a[0]);this._take&&(f.sort(function(a,b){return+b[g]-+a[g]}),f=this._take>0?f.slice(0,this._take):f.slice(this._take));var h=_.map(a,function(a){return c._generateSeries.call(c,a,f,b)});return h},_getMeasureIndex:function(a){return this._newMeasure&&this._newMeasure.name===a?this._newMeasure.index:this._headers.indexOf(a)},_getDimensionIndex:function(a){return this._headers.indexOf(a)},_generateSeries:function(a,b,c){var d=this,e=this._dimension,f=this._getMeasureIndex(a),g=_.map(b,function(a){var b=a[e],g=Date.parse(b),h=b==+b?+b:_.isNaN(g)?b:new Date(g),i={x:h,y:_.isNaN(+a[f])?a[f]:+a[f]};if(c){var j=_.map(c,function(a){return d._getMeasureIndex(a)}),k={};_.each(j,function(b,d){k[c[d]]=a[b]}),_.extend(i,k)}return i});return{name:a,data:g}}})}(),function(){"use strict";Contour.connectors.Csv=Contour.connectors.ConnectorBase.extend({constructor:function(a,b){return b="undefined"==typeof b?!0:b,this.parse(a,b),this._dimension=0,this},splitPattern:/,/,parse:function(a,b){if(this._data=[],this._headers=[],a&&a.length){var c=a.split(/\r\n|\r|\n/);this._headers=b?_.map(c.shift().split(this.splitPattern),function(a){return a.toLowerCase().trim()}):_.range(0,c[0].length),_.each(c.filter(function(a){return a.length}),function(a){this._data.push(a.split(this.splitPattern))},this)}}})}(),function(){"use strict";Contour.connectors.Json=Contour.connectors.ConnectorBase.extend({constructor:function(a){return this._dimension=0,this.parse(a),this},parse:function(a){this._headers=_.keys(a)||[],this._data=[];for(var b=0;b<this._headers.length;b++)for(var c=a[this._headers[b]],d=0;d<c.length;d++){var e=this._data[d]||(this._data[d]=[]);e.push(c[d])}}})}(),function(){"use strict";Contour.connectors.Tsv=Contour.connectors.Csv.extend({splitPattern:/\t/})}(),Contour.connectors.version="0.9.5";
//# sourceMappingURL=dist/contour.connectors.min.map